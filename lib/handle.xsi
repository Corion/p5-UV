MODULE = UV             PACKAGE = UV::oldHandle      PREFIX = p5uv_handle_

PROTOTYPES: ENABLE

void p5uv_handle__destruct(SV *self, int closed)
    PREINIT:
        uv_handle_t *handle;
    CODE:
        handle = (uv_handle_t *)xs_object_magic_get_struct_rv_pretty(aTHX_ self, "uv_handle_t in _destruct");
        if (closed) {
            p5uv_destroy_handle(aTHX_ handle);
            return;
        }
        if (!uv_is_closing(handle))
            uv_close(handle, handle_close_destroy_cb);
